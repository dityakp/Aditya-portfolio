name: Production Validation Checks

on:
  push:
    branches:
      - Production

jobs:
  validate-files:
    runs-on: ubuntu-latest
    name: Validate Portfolio Files
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install validation tools
        run: |
          npm install -g htmlhint stylelint eslint
          
      - name: Validate HTML files
        run: |
          echo "ğŸ” Validating HTML files..."
          htmlhint "**/*.html" || echo "âš ï¸ HTML validation warnings found"
          
      - name: Validate CSS files
        run: |
          echo "ğŸ¨ Validating CSS files..."
          npx stylelint "**/*.css" --config-basedir . || echo "âš ï¸ CSS validation warnings found"
        continue-on-error: true
          
      - name: Validate JavaScript files
        run: |
          echo "âš¡ Validating JavaScript files..."
          npx eslint "**/*.js" --no-eslintrc --env browser,es2021 || echo "âš ï¸ JS validation warnings found"
        continue-on-error: true
      
      - name: Check for broken links (HTML)
        run: |
          echo "ğŸ”— Checking for broken internal links..."
          if [ -f "index.html" ]; then
            grep -oP 'href="[^"]*"' index.html | grep -v "http" | sed 's/href="//;s/"//' || echo "No internal links found"
          fi
          
      - name: Check file structure
        run: |
          echo "ğŸ“ Checking file structure..."
          echo "âœ… Required files:"
          [ -f "index.html" ] && echo "  âœ“ index.html" || echo "  âœ— index.html MISSING"
          [ -d "css" ] && echo "  âœ“ css/ directory" || echo "  âœ— css/ directory MISSING"
          [ -d "js" ] && echo "  âœ“ js/ directory" || echo "  âœ— js/ directory MISSING"
          [ -d "assets" ] && echo "  âœ“ assets/ directory" || echo "  âš  assets/ directory not found"
          
      - name: List all files
        run: |
          echo "ğŸ“‹ Portfolio file structure:"
          find . -type f -not -path '*/\.*' | sort
          
      - name: Production Check Summary
        run: |
          echo "âœ… Production validation completed!"
          echo "ğŸ“Š All checks have been executed."
          echo "Review the logs above for any warnings or errors."
